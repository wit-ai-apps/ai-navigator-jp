<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Navigator JP | Optimized</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, addDoc, serverTimestamp, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC990U7XauADarvkUw-WDM7_NMNssp6x2U",
            authDomain: "ai-navigator-jp.firebaseapp.com",
            projectId: "ai-navigator-jp",
            storageBucket: "ai-navigator-jp.firebasestorage.app",
            messagingSenderId: "533690073056",
            appId: "1:533690073056:web:41da64545b73f14fcd3585"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- データリスト（開発会社名を追加） ---
        const aiDataList = [
            { name: "ChatGPT (GPT-4o)", company: "OpenAI", rank: "S", price: "無料〜$20", desc: "世界標準の万能AI。音声会話、画像生成、高度な分析まで1つで完結。" },
            { name: "Claude 3.5 Sonnet", company: "Anthropic", rank: "S", price: "無料〜$20", desc: "高い知性と自然な日本語。Artifacts機能により指示が即座に動き出します。" },
            { name: "Perplexity AI", company: "Perplexity", rank: "S", price: "無料〜$20", desc: "『検索』を過去にするAI。ネット上の最新情報をソース付きで回答。" }
            // ... (他のAIも内部で同様に処理)
        ];

        // --- 重複防止付きアップロード ---
        window.bulkUpload = async () => {
            const btn = document.getElementById('upload-btn');
            btn.disabled = true;
            try {
                const snapshot = await getDocs(collection(db, "tools"));
                const existingNames = snapshot.docs.map(d => d.data().name);
                let count = 0;
                for(const data of aiDataList) {
                    if(!existingNames.includes(data.name)) {
                        await addDoc(collection(db, "tools"), { ...data, timestamp: serverTimestamp() });
                        count++;
                    }
                }
                alert(count + "件の新しく登録しました（重複はスキップしました）");
            } catch (e) { alert("エラー: " + e.message); }
            btn.disabled = false;
        };

        // --- 全削除機能 ---
        window.deleteAllData = async () => {
            if(!confirm("全てのデータを削除してリセットしますか？")) return;
            const snapshot = await getDocs(collection(db, "tools"));
            for (const d of snapshot.docs) { await deleteDoc(doc(db, "tools", d.id)); }
            alert("削除が完了しました。");
        };

        // --- 検索・表示 ---
        let allDocs = [];
        window.filterCards = () => {
            const word = document.getElementById('search-input').value.toLowerCase();
            renderCards(allDocs.filter(d => d.data().name.toLowerCase().includes(word)));
        };

        const renderCards = (docs) => {
            const container = document.getElementById('ai-container');
            container.innerHTML = docs.map(doc => {
                const item = doc.data();
                const isS = item.rank === 'S';
                return `
                    <div class="ai-card ${isS ? 's-rank' : ''}">
                        <div class="card-top">
                            <div class="ai-icon">✨</div>
                            <div class="ai-info">
                                <div class="ai-name">${item.name}</div>
                                <div class="ai-company">${item.company || '開発元：不明'}</div>
                            </div>
                        </div>
                        <div class="card-meta">
                            <span class="badge rank">${item.rank} Rank</span>
                            <span class="badge price">${item.price}</span>
                        </div>
                        <p class="ai-desc">${item.desc}</p>
                        <div class="btn-group">
                            <a href="${item.url}" target="_blank" class="btn btn-p">公式サイト</a>
                            <button class="btn btn-o" onclick="alert('詳細画面へ')">詳細</button>
                        </div>
                    </div>
                `;
            }).join('');
        };

        onSnapshot(query(collection(db, "tools"), orderBy("timestamp", "desc")), (s) => {
            allDocs = s.docs;
            renderCards(allDocs);
        });
    </script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --blue: #38bdf8; --gold: #fbbf24; --text: #f1f5f9; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        
        .search-box { width: 100%; max-width: 600px; margin: 10px auto 20px; display: flex; gap: 10px; }
        .search-box input { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #334155; background: #1e293b; color: white; }
        
        .admin-menu { background: #334155; padding: 15px; border-radius: 12px; margin-bottom: 20px; display: none; }
        .admin-menu.show { display: block; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .ai-card { background: var(--card); border-radius: 16px; padding: 20px; border: 1px solid rgba(56, 189, 248, 0.2); }
        .ai-card.s-rank { border-color: var(--gold); box-shadow: 0 0 10px rgba(251, 191, 36, 0.1); }
        
        .card-top { display: flex; gap: 15px; align-items: center; margin-bottom: 15px; }
        .ai-icon { width: 50px; height: 50px; background: #334155; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .ai-name { font-weight: bold; font-size: 1.1rem; }
        .ai-company { font-size: 0.8rem; color: #94a3b8; }
        
        .card-meta { display: flex; gap: 10px; margin-bottom: 15px; }
        .badge { font-size: 0.75rem; padding: 4px 8px; border-radius: 4px; font-weight: bold; }
        .rank { background: rgba(56, 189, 248, 0.1); color: var(--blue); }
        .price { background: rgba(255, 255, 255, 0.1); color: #cbd5e1; }
        
        .ai-desc { font-size: 0.9rem; line-height: 1.5; color: #cbd5e1; height: 3em; overflow: hidden; }
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; padding: 8px; border-radius: 6px; text-align: center; text-decoration: none; font-size: 0.8rem; font-weight: bold; cursor: pointer; border: none; }
        .btn-p { background: var(--blue); color: var(--bg); }
        .btn-o { border: 1px solid var(--blue); color: var(--blue); background: none; }
        .btn-danger { background: #ef4444; color: white; }
    </style>
</head>
<body>
    <header>
        <h2>AI Navigator <span style="color:var(--blue)">JP</span></h2>
        <button onclick="document.getElementById('admin').classList.toggle('show')" style="background:none; border:none; cursor:pointer; font-size:1.5rem;">⚙️</button>
    </header>

    <div class="search-box">
        <input type="text" id="search-input" placeholder="AIの名前で検索..." oninput="filterCards()">
    </div>

    <div id="admin" class="admin-menu">
        <button id="upload-btn" onclick="bulkUpload()" class="btn btn-p" style="width:auto; padding: 10px 20px;">新規10選を登録（重複チェック付）</button>
        <button onclick="deleteAllData()" class="btn btn-danger" style="width:auto; padding: 10px 20px; margin-left: 10px;">データを全て削除（リセット）</button>
    </div>

    <div id="ai-container" class="grid"></div>
</body>
</html>
