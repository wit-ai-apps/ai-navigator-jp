<script>
// --- [1] グローバル基盤 (SSOT & Storage) ---
window.VERSION_INFO = 'v22.8.18.1 [2026-02-22_1640_deletion-migration]';
window.spLSGet = function(k) { try { return localStorage.getItem(k); } catch(e) { return null; } };
window.spLSSet = function(k, v) { try { localStorage.setItem(k, v); } catch(e) {} };

// --- [2] 削除機能の移設 ---
// 設定モーダル内に以下のロジックを統合します
async function deleteProductHistory(jan) {
  const ok = await customConfirm(`商品コード ${jan} の全履歴を削除しますか？`);
  if (!ok) return;
  
  if (db.products[jan]) {
    delete db.products[jan];
    saveLocalOnly();
    syncFirebasePut();
    showToast("商品を削除しました");
    renderHistory();
    closeSettings();
  }
}

// --- [3] スキャンボタンの物理的復旧 ---
function forceScanBinding() {
  const btn = document.getElementById('scanBtnTop');
  if (!btn) return;

  const handleAction = (e) => {
    e.preventDefault();
    if (typeof startScanner === 'function') startScanner();
  };

  btn.addEventListener('touchstart', handleAction, { passive: false });
  btn.addEventListener('click', handleAction, { passive: false });
}

// --- [4] 初期化実行 ---
window.addEventListener('DOMContentLoaded', () => {
  forceScanBinding();
  loadLocal(); // dbの読み込み
  renderHistory();
  console.log(window.VERSION_INFO + " initialized.");
});
</script>

<div id="panelOperator" class="sp-panel mt-3" style="display:none;">
    <button class="btn btn-outline-danger w-100 mt-3" onclick="promptSpecificDelete()">商品を個別に削除</button>
</div>
